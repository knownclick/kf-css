@use 'sass:map';
@use 'sass:math';

@mixin generate-utils($name, $config) {
  $step: map.get($config, 'transparency-step');
  // Only calculate loops if step is greater than 0
  $loops: 0;
  @if $step > 0 {
    $loops: math.floor(math.div(100, $step));
  }

  $tints: map.get($config, 'tint-count');
  $shades: map.get($config, 'shade-count');

  // Generates: .text-primary, .text-primary-50, .text-primary-l-1...
  @if map.get($config, 'generate-text') {
    .text-#{$name} {
      color: var(--#{$name});
    }

    // Transparency
    @if $step > 0 {
      @for $i from 1 through ($loops - 1) {
        $pct: $i * $step;
        .text-#{$name}-#{$pct} {
          color: var(--#{$name}-#{$pct});
        }
      }
    }
    // Tints
    @if $tints > 0 {
      @for $i from 1 through $tints {
        .text-#{$name}-l-#{$i} {
          color: var(--#{$name}-l-#{$i});
        }
      }
    }
    // Shades
    @if $shades > 0 {
      @for $i from 1 through $shades {
        .text-#{$name}-d-#{$i} {
          color: var(--#{$name}-d-#{$i});
        }
      }
    }
  }

  // Generates: .bg-primary, .bg-primary-50...
  @if map.get($config, 'generate-bg') {
    .bg-#{$name} {
      background-color: var(--#{$name});
    }

    // Transparency
    @if $step > 0 {
      @for $i from 1 through ($loops - 1) {
        $pct: $i * $step;
        .bg-#{$name}-#{$pct} {
          background-color: var(--#{$name}-#{$pct});
        }
      }
    }
    // Tints
    @if $tints > 0 {
      @for $i from 1 through $tints {
        .bg-#{$name}-l-#{$i} {
          background-color: var(--#{$name}-l-#{$i});
        }
      }
    }
    // Shades
    @if $shades > 0 {
      @for $i from 1 through $shades {
        .bg-#{$name}-d-#{$i} {
          background-color: var(--#{$name}-d-#{$i});
        }
      }
    }
  }

  // Generates: .border-primary, .border-primary-50...
  @if map.get($config, 'generate-border') {
    .border-#{$name} {
      border-color: var(--#{$name});
    }

    // Transparency
    @if $step > 0 {
      @for $i from 1 through ($loops - 1) {
        $pct: $i * $step;
        .border-#{$name}-#{$pct} {
          border-color: var(--#{$name}-#{$pct});
        }
      }
    }
    // Tints
    @if $tints > 0 {
      @for $i from 1 through $tints {
        .border-#{$name}-l-#{$i} {
          border-color: var(--#{$name}-l-#{$i});
        }
      }
    }
    // Shades
    @if $shades > 0 {
      @for $i from 1 through $shades {
        .border-#{$name}-d-#{$i} {
          border-color: var(--#{$name}-d-#{$i});
        }
      }
    }
  }

  // Generates: .fill-primary, .fill-primary-50... (For SVGs)
  @if map.get($config, 'generate-fill') {
    .fill-#{$name} {
      fill: var(--#{$name});
    }

    // Transparency
    @if $step > 0 {
      @for $i from 1 through ($loops - 1) {
        $pct: $i * $step;
        .fill-#{$name}-#{$pct} {
          fill: var(--#{$name}-#{$pct});
        }
      }
    }
    // Tints
    @if $tints > 0 {
      @for $i from 1 through $tints {
        .fill-#{$name}-l-#{$i} {
          fill: var(--#{$name}-l-#{$i});
        }
      }
    }
    // Shades
    @if $shades > 0 {
      @for $i from 1 through $shades {
        .fill-#{$name}-d-#{$i} {
          fill: var(--#{$name}-d-#{$i});
        }
      }
    }
  }
  // 5. Interactive States (Hover/Focus/Active)
  @if map.get($config, 'generate-interactive') {
    // Background Interactivity
    @if map.get($config, 'generate-bg') {
      .hover\:bg-#{$name}:hover {
        background-color: var(--#{$name});
      }
      .focus\:bg-#{$name}:focus {
        background-color: var(--#{$name});
      }
      .active\:bg-#{$name}:active {
        background-color: var(--#{$name});
      }

      // Generate shades for hover (common pattern: hover:bg-primary-d-1)
      @if $shades > 0 {
        @for $i from 1 through $shades {
          .hover\:bg-#{$name}-d-#{$i}:hover {
            background-color: var(--#{$name}-d-#{$i});
          }
          .active\:bg-#{$name}-d-#{$i}:active {
            background-color: var(--#{$name}-d-#{$i});
          }
        }
      }
    }

    // Text Interactivity
    @if map.get($config, 'generate-text') {
      .hover\:text-#{$name}:hover {
        color: var(--#{$name});
      }
      .focus\:text-#{$name}:focus {
        color: var(--#{$name});
      }
    }

    // Border Interactivity
    @if map.get($config, 'generate-border') {
      .hover\:border-#{$name}:hover {
        border-color: var(--#{$name});
      }
      .focus\:border-#{$name}:focus-within {
        border-color: var(--#{$name});
      }
      .focus\:border-#{$name}:focus {
        border-color: var(--#{$name});
      }
    }
  }
}
